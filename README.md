# Сервис Docker Compose: `dnscrypt-proxy` и `app`

Этот репозиторий содержит конфигурацию для разворачивания двух взаимозависимых сервисов с помощью Docker Compose:
1. **dnscrypt-proxy** — локальный прокси для DNS-запросов, обеспечивающий шифрование и анонимность.
2. **app** — любое приложение, которое зависимо от работоспособности DNS-прокси и использует его в качестве DNS-сервера.

---

## Содержание

1. [Описание сервисов](#описание-сервисов)  
   1.1. [dnscrypt-proxy](#dnscrypt-proxy)  
   1.2. [app](#app)  
2. [Требования](#требования)  
3. [Структура репозитория](#структура-репозитория)  
4. [Переменные окружения](#переменные-окружения)  
5. [Установка и запуск](#установка-и-запуск)  
6. [Сетевые настройки](#сетевые-настройки)  
7. [Проверка работоспособности](#проверка-работоспособности)  
8. [Полезные команды](#полезные-команды)  
9. [Лицензия](#лицензия)  

---

## Описание сервисов

### dnscrypt-proxy

- **Назначение**:  
  `dnscrypt-proxy` выступает локальным прокси-сервером для DNS-запросов, шифруя их и пересылая к выбранному внешнему DNS-серверу (например, Cloudflare). Это повышает приватность и защищенность DNS-трафика.

- **Ключевые параметры в `docker-compose.yml`**:
  - `build: ./dnscrypt-proxy` — сборка образа из директории `./dnscrypt-proxy`.
  - `container_name: dnscrypt-proxy` — имя контейнера.
  - `restart: unless-stopped` — перезапуск контейнера в случае сбоя, если он явно не остановлен.
  - `networks.internal.ipv4_address: 172.25.0.2` — статический внутренний IP-адрес в мостовой сети `internal`.
  - `healthcheck`:
    - `test: ["CMD", "drill", "cloudflare.com", "@127.0.0.1"]` — проверка, что DNS-прокси отвечает на запросы к домену например `cloudflare.com`.
    - `interval: 10s`, `timeout: 3s`, `retries: 3` — параметры интервала проверки, таймаута и числа попыток.

### app

- **Назначение**:  
  Основное приложение, которое при запуске использует DNS-прокси для всех своих DNS-запросов. В переменной окружения передаётся `GEMINI_API_KEY` (например, для доступа к API Gemini или иным сервисам).

- **Ключевые параметры в `docker-compose.yml`**:
  - `build: ./app` — сборка образа из директории `./app`.
  - `container_name: app` — имя контейнера.
  - `depends_on.dnscrypt-proxy.condition: service_healthy` — ожидание успешного прохождения healthcheck контейнера `dnscrypt-proxy` перед запуском `app`.
  - `networks.internal.ipv4_address: 172.25.0.3` — статический внутренний IP-адрес в мостовой сети `internal`.
  - `environment: - GEMINI_API_KEY=${GEMINI_API_KEY}` — передача переменной окружения из хоста.
  - `dns: - 172.25.0.2` — указание использовать локальный DNS-сервер (контейнер `dnscrypt-proxy`).

---

## Требования

1. **Docker**
2. **Docker Compose**
3. **Переменная окружения** `GEMINI_API_KEY` должна быть определена на хостовой машине, если приложение `app` действительно использует этот ключ.

---